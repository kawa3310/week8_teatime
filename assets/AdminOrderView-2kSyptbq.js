import{a as u,S as h}from"./sweetalert2.all-Pn1vR6wA.js";import{_ as w,M as D,o,c as d,a as e,t as r,q as g,F as _,j as k,b as y,s as M,r as p,e as m,n as S}from"./index-YrOX5VuD.js";import{P as V,D as E}from"./DelProductModal-BMJnE_vH.js";const P={data(){return{orderModal:null,emitOrder:{},is_paid:!1}},props:["tempOrder","isNew","addOrderStates"],emits:["addOrderStates"],methods:{modelOpen(){this.orderModal.show()},modalClose(){this.orderModal.hide()}},mounted(){this.orderModal=new D(this.$refs.orderModal),this.emitOrder=this.tempOrder},watch:{tempOrder(){this.emitOrder=this.tempOrder}}},N={id:"orderModal",ref:"orderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},B={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},L={class:"modal-content border-0"},A=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{id:"orderModalLabel",class:"modal-title"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),T={class:"modal-body"},I={class:"row"},U={class:"col-md-16"},R=e("h3",null,"訂單資料",-1),z={class:"table"},j={key:0},q=e("th",{style:{width:"100px"}},"訂單編號",-1),F=e("th",null,"訂單時間",-1),H=e("th",{style:{width:"100px"}},"收件人",-1),G=e("th",null,"Email",-1),J=e("th",null,"聯絡電話",-1),K=e("th",null,"收件地址",-1),Q=e("th",null,"付款狀態",-1),W={key:0},X={key:1},Y=e("th",null,"總金額",-1),Z=e("h3",null,"選購商品",-1),ee={class:"table"},te=e("thead",null,[e("tr")],-1),se={class:"d-flex justify-content-end"},oe={class:"form-check"},de={class:"form-check-label",for:"flexCheckDefault"},re={key:0},ie={key:1},le={class:"modal-footer"},ne=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ae(s,i,O,v,t,a){return o(),d("div",N,[e("div",B,[e("div",L,[A,e("div",T,[e("div",I,[e("div",U,[R,e("table",z,[t.emitOrder.user?(o(),d("tbody",j,[e("tr",null,[q,e("td",null,r(t.emitOrder.id),1)]),e("tr",null,[F,e("td",null,r(s.$filter.date(t.emitOrder.create_at)),1)]),e("tr",null,[H,e("td",null,r(t.emitOrder.user.name),1)]),e("tr",null,[G,e("td",null,r(t.emitOrder.user.email),1)]),e("tr",null,[J,e("td",null,r(t.emitOrder.user.tel),1)]),e("tr",null,[K,e("td",null,r(t.emitOrder.user.address),1)]),e("tr",null,[Q,e("td",null,[t.emitOrder.paid_date?(o(),d("span",W,"已付款")):(o(),d("span",X,"尚未付款"))])]),e("tr",null,[Y,e("td",null,"$"+r(t.emitOrder.total),1)])])):g("",!0)]),Z,e("table",ee,[te,e("tbody",null,[(o(!0),d(_,null,k(t.emitOrder.products,n=>(o(),d("tr",{key:n.id},[e("th",null,r(n.product.title),1),e("td",null,r(n.qty)+" / "+r(n.product.unit),1),e("td",null,r(n.product.final_total),1),e("td",null,r(s.$filter.currency(n.final_total)),1)]))),128))])]),e("div",se,[e("div",oe,[y(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":i[0]||(i[0]=n=>t.emitOrder.is_paid=n)},null,512),[[M,t.emitOrder.is_paid]]),e("label",de,[t.emitOrder.is_paid?(o(),d("span",re,"已付款")):(o(),d("span",ie,"未付款"))])])])])])]),e("div",le,[ne,e("button",{type:"button",class:"btn btn-primary",onClick:i[1]||(i[1]=n=>s.$emit("addOrderStates",t.emitOrder))}," 修改狀態 ")])])])],512)}const ce=w(P,[["render",ae]]);var he={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"reirei",BASE_URL:"/week8_teatime/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:f,VITE_PATH:b}=he,ue={data(){return{pagination:{},orderData:{},tempOrder:{},pages:{},isNew:!1,isloading:!1}},methods:{cheakLongin(){u.post(`${f}/api/user/check`).then(()=>{this.getOrders()}).catch(s=>{this.$router.push("/"),h.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:s.response.data.message})})},getOrders(s=1){this.isloading=!0,u.get(`${f}/api/${b}/admin/orders?page=${s}`).then(i=>{this.isloading=!1,this.orderData=i.data.orders,this.pages=i.data.pagination}).catch(i=>{this.isloading=!0,h.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:i.response.data.message})})},openModel(s,i){this.isNew=!0,s==="look"?(this.isNew=!1,this.tempOrder={...i},this.$refs.orderModal.modelOpen()):s==="dele"&&(this.tempOrder={...i},this.$refs.deModal.modelOpen())},addOrderStates(s){this.isNew=!0,this.isloading=!0;const i={is_paid:s.is_paid};u.put(`${f}/api/${b}/admin/order/${s.id}`,{data:i}).then(()=>{this.isNew=!1,this.isloading=!1,this.$refs.orderModal.modalClose(),this.getOrders(),h.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"success",title:"編輯成功"})}).catch(O=>{this.isloading=!1,h.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:O.response.data.message})})},delOrder(){this.isNew=!0,this.isloading=!0,u.delete(`${f}/api/${b}/admin/order/${this.tempOrder.id}`).then(()=>{this.isNew=!1,this.isloading=!1,this.$refs.deModal.modalClose(),this.getOrders(),h.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"success",title:"刪除成功"})}).catch(s=>{this.isloading=!1,h.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:s.response.data.message})})}},mounted(){const s=document.cookie.replace(/(?:(?:^|.*;\s*)kawaToken\s*=\s*([^;]*).*$)|^.*$/,"$1");u.defaults.headers.common.Authorization=s,this.cheakLongin()},components:{PaginationModal:V,OrderModal:ce,DelProductModal:E}},_e={class:"container px-6"},pe={class:"text-end mt-4"},me={class:"table mt-4"},fe=e("thead",null,[e("tr",null,[e("th",{width:"120"},"購買日期"),e("th",{width:"120"},"Email"),e("th",{width:"120"},"品項"),e("th",{width:"120"},"應付金額"),e("th",{width:"120"},"付款狀態"),e("th",{width:"120"},"編輯")])],-1),Oe=["textContent"],be={class:"list-unstyled"},ge={class:"form-check form-switch"},ke=["onUpdate:modelValue","id","onChange"],we=["for"],ye={key:0},Me={key:1},ve={class:"btn-group"},$e=["onClick"],Ce=["onClick"];function xe(s,i,O,v,t,a){const n=p("VueLoading"),$=p("PaginationModal"),C=p("OrderModal"),x=p("DelProductModal");return o(),d(_,null,[m(n,{active:t.isloading,"z-index":1060},null,8,["active"]),e("div",_e,[e("div",pe,[e("table",me,[fe,e("tbody",null,[(o(!0),d(_,null,k(t.orderData,l=>(o(),d(_,{key:l.id},[t.orderData.length?(o(),d("tr",{key:0,class:S({"text-secondary":!l.is_paid})},[e("td",null,r(s.$filter.date(l.create_at)),1),e("td",null,[l.user?(o(),d("span",{key:0,textContent:r(l.user.email)},null,8,Oe)):g("",!0)]),e("td",null,[e("ul",be,[(o(!0),d(_,null,k(l.products,c=>(o(),d("li",{key:c.id},r(c.product.title),1))),128))])]),e("td",null,r(l.total),1),e("td",null,[e("div",ge,[y(e("input",{class:"form-check-input","onUpdate:modelValue":c=>l.is_paid=c,type:"checkbox",role:"switch",id:`paidSwitch${l.id}`,onChange:c=>a.addOrderStates(l)},null,40,ke),[[M,l.is_paid]]),e("label",{class:"form-check-label",for:`paidSwitch${l.id}`},[l.is_paid?(o(),d("span",ye,"已付款")):(o(),d("span",Me,"未付款"))],8,we)])]),e("div",ve,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:c=>a.openModel("look",l)}," 查看 ",8,$e),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:c=>a.openModel("dele",l)}," 刪除 ",8,Ce)])],2)):g("",!0)],64))),128))])])])]),m($,{pages:t.pages,onEmitPages:a.getOrders},null,8,["pages","onEmitPages"]),m(C,{"temp-Order":t.tempOrder,ref:"orderModal",onAddOrderStates:a.addOrderStates},null,8,["temp-Order","onAddOrderStates"]),m(x,{item:t.tempOrder,onDelItem:a.delOrder,ref:"deModal"},null,8,["item","onDelItem"])],64)}const Ee=w(ue,[["render",xe]]);export{Ee as default};
