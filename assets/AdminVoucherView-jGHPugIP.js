import{a as v}from"./axios-G2rPRu76.js";import{S as p}from"./sweetalert2.all-jY29oZH4.js";import{_ as k,M as D,r as a,o as r,c,b as e,t as _,d as l,w as $,n as g,j as w,l as x,u as E,i as P,F as M,h as N}from"./index-4Q5E_xTk.js";import{D as T,P as B}from"./DelProductModal-tHfXYOJL.js";const L={data(){return{voucher:null,emitVoucher:{},due_date:""}},props:["tempVoucher","isNew"],methods:{modelOpen(){this.voucher.show()},modalClose(){this.voucher.hide()}},mounted(){this.voucher=new D(this.$refs.VoucherModal)},watch:{tempVoucher(){this.emitVoucher=this.tempVoucher;const o=new Date(this.emitVoucher.due_date*1e3).toISOString().split("T");[this.due_date]=o},due_date(){this.emitVoucher.due_date=Math.floor(new Date(this.due_date)/1e3)}}},S={id:"VoucherModal",ref:"VoucherModal",class:"modal fade",tabindex:"-1","aria-labelledby":"VoucherModalLabel","aria-hidden":"true"},U={class:"modal-dialog",role:"document"},I={class:"modal-content"},O={class:"modal-header"},F={id:"VoucherModalLabel",class:"modal-title"},R=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),A={class:"modal-body"},q={class:"mb-3"},z=e("label",{for:"title",class:"form-label"},"標題",-1),H={class:"mb-3"},j=e("label",{for:"coupon_code",class:"form-label"},"優惠碼",-1),G={class:"mb-3"},J=e("label",{for:"due_date"},"到期日",-1),K={class:"mb-3"},Q=e("label",{for:"price",class:"form-label"},"折扣",-1),W={class:"mb-3"},X={class:"form-check"},Y=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Z={class:"modal-footer"},ee=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function te(o,t,u,y,s,n){const h=a("VField"),m=a("ErrorMessage"),b=a("VForm");return r(),c("div",S,[e("div",U,[e("div",I,[e("div",O,[e("h5",F,[e("span",null,_(`${u.isNew?"新增":"編輯"}`),1)]),R]),e("div",A,[l(b,{ref:"form",class:"col-md-6"},{default:$(({errors:d})=>[e("div",q,[z,l(h,{id:"title",name:"標題",type:"text",class:g(["form-control",{"is-invalid":d.標題}]),placeholder:"請輸入標題",rules:"required",modelValue:s.emitVoucher.title,"onUpdate:modelValue":t[0]||(t[0]=i=>s.emitVoucher.title=i)},null,8,["class","modelValue"]),l(m,{name:"標題",class:"invalid-feedback"})]),e("div",H,[j,l(h,{id:"coupon_code",name:"優惠碼",type:"text",class:g(["form-control",{"is-invalid":d.優惠碼}]),placeholder:"請輸入優惠碼",rules:"required",modelValue:s.emitVoucher.code,"onUpdate:modelValue":t[1]||(t[1]=i=>s.emitVoucher.code=i)},null,8,["class","modelValue"]),l(m,{name:"優惠碼",class:"invalid-feedback"})]),e("div",G,[J,w(e("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[2]||(t[2]=i=>s.due_date=i)},null,512),[[x,s.due_date]])]),e("div",K,[Q,l(h,{id:"price",min:"1",max:"75",name:"折扣百分比",type:"number",class:g(["form-control",{"is-invalid":d.折扣百分比}]),placeholder:"請輸入折扣百分比",rules:"positive",modelValue:s.emitVoucher.percent,"onUpdate:modelValue":t[3]||(t[3]=i=>s.emitVoucher.percent=i)},null,8,["class","modelValue"]),l(m,{name:"折扣百分比",class:"invalid-feedback"})]),e("div",W,[e("div",X,[w(e("input",{"true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=i=>s.emitVoucher.is_enabled=i),id:"is_enabled",class:"form-check-input",type:"checkbox",checked:!1},null,512),[[E,s.emitVoucher.is_enabled]]),Y])])]),_:1},512)]),e("div",Z,[ee,e("button",{type:"button",class:"btn btn-primary",onClick:t[5]||(t[5]=d=>o.$emit("edit-Voucher",s.emitVoucher))},_(u.isNew?"新增優惠卷":"更新優惠卷"),1)])])])],512)}const oe=k(L,[["render",te]]);var se={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"reirei",BASE_URL:"/week8_teatime/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:f,VITE_PATH:V}=se,ie={data(){return{voucher:{},tempVoucher:this.resetVoucher(),isNew:!1,pages:{},isloading:!1}},methods:{getVoucherData(){this.isloading=!0,v.get(`${f}/api/${V}/admin/coupons`).then(o=>{this.isloading=!1,this.voucher=o.data.coupons,this.pages=o.data.pagination}).catch(o=>{this.isloading=!1,p.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,title:o.response.data.message})})},resetVoucher(){return{title:"",is_enabled:0,percent:100,code:"",due_date:new Date().getTime()/1e3}},openModel(o,t){o==="new"?(this.isNew=!0,this.tempVoucher=this.resetVoucher(),this.$refs.voucher.modelOpen()):o==="edit"?(this.isNew=!1,this.tempVoucher={...t},this.$refs.voucher.modelOpen()):o==="dele"&&(this.tempVoucher={...t},this.$refs.deModal.modelOpen())},editVoucher(){let o=`${f}/api/${V}/admin/coupon`,t="post";this.isNew||(this.isloading=!0,o=`${f}/api/${V}/admin/coupon/${this.tempVoucher.id}`,t="put"),this.isloading=!0,v[t](o,{data:this.tempVoucher}).then(()=>{p.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"success",title:"編輯成功"}),this.isloading=!1,this.$refs.voucher.modalClose(),this.getVoucherData()}).catch(u=>{this.isloading=!1,p.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:u.response.data.message})})},delProduct(){this.isloading=!0,v.delete(`${f}/api/${V}/admin/coupon/${this.tempVoucher.id}`).then(()=>{this.isloading=!1,this.$refs.deModal.modalClose(),this.getVoucherData(),p.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"success",title:"已刪除"})}).catch(o=>{this.isloading=!1,p.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:o.response.data.message})})}},mounted(){this.getVoucherData()},components:{VoucherModal:oe,DelProductModal:T,PaginationModal:B}},le={class:"container px-6"},ne={class:"text-end"},ae={href:"#"},de={class:"table"},re=e("caption",{class:"fs-4 my-4"},"管理優惠卷",-1),ce=e("thead",null,[e("tr",null,[e("th",{width:"120"},"名稱"),e("th",{width:"120"},"折扣百分比"),e("th",{width:"120"},"到期日"),e("th",{width:"120"},"是否啟用"),e("th",{width:"120"},"編輯")])],-1),ue={key:0,class:"text-success"},he={key:1},me={class:"btn-group"},pe=["onClick"],_e=["onClick"];function fe(o,t,u,y,s,n){const h=a("VueLoading"),m=a("PaginationModal"),b=a("VoucherModal"),d=a("DelProductModal");return r(),c(M,null,[l(h,{active:s.isloading,"z-index":1060},null,8,["active"]),e("div",le,[e("div",ne,[e("a",ae,[e("i",{class:"btn bi bi-plus-square plus-add-btn",onClick:t[0]||(t[0]=P(i=>n.openModel("new"),["prevent"]))})])]),e("table",de,[re,ce,e("tbody",null,[(r(!0),c(M,null,N(s.voucher,i=>(r(),c("tr",{key:i.id},[e("td",null,_(i.title),1),e("td",null,_(i.percent)+"%",1),e("td",null,_(o.$filter.date(i.due_date)),1),e("td",null,[i.is_enabled===1?(r(),c("span",ue,"啟用")):(r(),c("span",he,"未啟用"))]),e("td",null,[e("div",me,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:C=>n.openModel("edit",i)}," 編輯 ",8,pe),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:C=>n.openModel("dele",i)}," 刪除 ",8,_e)])])]))),128))])])]),l(m,{pages:s.pages,onEmitPages:n.getVoucherData},null,8,["pages","onEmitPages"]),l(b,{"is-New":s.isNew,"temp-Voucher":s.tempVoucher,onEditVoucher:n.editVoucher,ref:"voucher"},null,8,["is-New","temp-Voucher","onEditVoucher"]),l(d,{onDelItem:n.delProduct,"temp-Voucher":s.tempVoucher,ref:"deModal"},null,8,["onDelItem","temp-Voucher"])],64)}const we=k(ie,[["render",fe]]);export{we as default};
