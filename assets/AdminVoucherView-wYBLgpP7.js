import{a as _,S as u}from"./sweetalert2.all-VTsAtsNN.js";import{_ as M,M as C,r,o as l,c as a,a as e,e as n,f as D,n as g,b as w,v as x,s as E,t as b,F as k,j as P}from"./index-omQM2LBf.js";import{D as T,P as B}from"./DelProductModal-_gMAJAgX.js";const L={data(){return{voucher:null,emitVoucher:{},due_date:""}},props:["tempVoucher","isNew"],methods:{modelOpen(){this.voucher.show()},modalClose(){this.voucher.hide()}},mounted(){this.voucher=new C(this.$refs.VoucherModal)},watch:{tempVoucher(){this.emitVoucher=this.tempVoucher;const t=new Date(this.emitVoucher.due_date*1e3).toISOString().split("T");[this.due_date]=t},due_date(){this.emitVoucher.due_date=Math.floor(new Date(this.due_date)/1e3)}}},N={id:"VoucherModal",ref:"VoucherModal",class:"modal fade",tabindex:"-1","aria-labelledby":"VoucherModalLabel","aria-hidden":"true"},S={class:"modal-dialog",role:"document"},U={class:"modal-content"},I={class:"modal-header"},O={id:"VoucherModalLabel",class:"modal-title"},F={key:0},A={key:1},R=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),q={class:"modal-body"},z={class:"mb-3"},H=e("label",{for:"title",class:"form-label"},"標題",-1),j={class:"mb-3"},G=e("label",{for:"coupon_code",class:"form-label"},"優惠碼",-1),J={class:"mb-3"},K=e("label",{for:"due_date"},"到期日",-1),Q={class:"mb-3"},W=e("label",{for:"price",class:"form-label"},"折扣",-1),X={class:"mb-3"},Y={class:"form-check"},Z=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),ee={class:"modal-footer"},te=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function oe(t,o,h,y,s,d){const m=r("VField"),p=r("ErrorMessage"),v=r("VForm");return l(),a("div",N,[e("div",S,[e("div",U,[e("div",I,[e("h5",O,[h.isNew?(l(),a("span",F,"新增優惠卷")):(l(),a("span",A,"編輯優惠卷"))]),R]),e("div",q,[n(v,{ref:"form",class:"col-md-6"},{default:D(({errors:c})=>[e("div",z,[H,n(m,{id:"title",name:"標題",type:"text",class:g(["form-control",{"is-invalid":c.標題}]),placeholder:"請輸入標題",rules:"required",modelValue:s.emitVoucher.title,"onUpdate:modelValue":o[0]||(o[0]=i=>s.emitVoucher.title=i)},null,8,["class","modelValue"]),n(p,{name:"標題",class:"invalid-feedback"})]),e("div",j,[G,n(m,{id:"coupon_code",name:"優惠碼",type:"text",class:g(["form-control",{"is-invalid":c.優惠碼}]),placeholder:"請輸入優惠碼",rules:"required",modelValue:s.emitVoucher.code,"onUpdate:modelValue":o[1]||(o[1]=i=>s.emitVoucher.code=i)},null,8,["class","modelValue"]),n(p,{name:"優惠碼",class:"invalid-feedback"})]),e("div",J,[K,w(e("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":o[2]||(o[2]=i=>s.due_date=i)},null,512),[[x,s.due_date]])]),e("div",Q,[W,n(m,{id:"price",max:"75",name:"折扣百分比",type:"number",class:g(["form-control",{"is-invalid":c.折扣百分比}]),placeholder:"請輸入折扣百分比",rules:"required",modelValue:s.emitVoucher.percent,"onUpdate:modelValue":o[3]||(o[3]=i=>s.emitVoucher.percent=i)},null,8,["class","modelValue"]),n(p,{name:"折扣百分比",class:"invalid-feedback"})]),e("div",X,[e("div",Y,[w(e("input",{"true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=i=>s.emitVoucher.is_enabled=i),id:"is_enabled",class:"form-check-input",type:"checkbox"},null,512),[[E,s.emitVoucher.is_enabled]]),Z])])]),_:1},512)]),e("div",ee,[te,e("button",{type:"button",class:"btn btn-primary",onClick:o[5]||(o[5]=c=>t.$emit("edit-Voucher",s.emitVoucher))},b(h.isNew?"新增優惠卷":"更新優惠卷"),1)])])])],512)}const se=M(L,[["render",oe]]);var ie={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"reirei",BASE_URL:"/week8_teatime/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:f,VITE_PATH:V}=ie,ne={data(){return{voucher:{},tempVoucher:{title:"",is_enabled:0,percent:100,code:""},isNew:!1,pages:{},isloading:!1}},methods:{cheakLongin(){_.post(`${f}/api/user/check`).then(()=>{this.getVoucherData()}).catch(t=>{this.$router.push("/login"),u.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:t.response.data.message})})},getVoucherData(){this.isloading=!0,_.get(`${f}/api/${V}/admin/coupons`).then(t=>{this.isloading=!1,this.voucher=t.data.coupons,this.pages=t.data.pagination}).catch(t=>{this.isloading=!1,u.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,title:t.response.data.message})})},openModel(t,o){t==="new"?(this.isNew=!0,this.tempVoucher={due_date:new Date().getTime()/1e3},this.$refs.voucher.modelOpen()):t==="edit"?(this.isNew=!1,this.tempVoucher={...o},this.$refs.voucher.modelOpen()):t==="dele"&&(this.tempVoucher={...o},this.$refs.deModal.modelOpen())},editVoucher(){let t=`${f}/api/${V}/admin/coupon`,o="post";this.isNew||(this.isloading=!0,t=`${f}/api/${V}/admin/coupon/${this.tempVoucher.id}`,o="put"),this.isloading=!0,_[o](t,{data:this.tempVoucher}).then(()=>{u.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"success",title:"編輯成功"}),this.isloading=!1,this.$refs.voucher.modalClose(),this.getVoucherData()}).catch(h=>{this.isloading=!1,u.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:h.response.data.message})})},delProduct(){this.isloading=!0,_.delete(`${f}/api/${V}/admin/coupon/${this.tempVoucher.id}`).then(()=>{this.isloading=!1,this.$refs.deModal.modalClose(),this.getVoucherData(),u.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"success",title:"已刪除"})}).catch(t=>{this.isloading=!1,u.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:t.response.data.message})})}},mounted(){const t=document.cookie.replace(/(?:(?:^|.*;\s*)kawaToken\s*=\s*([^;]*).*$)|^.*$/,"$1");_.defaults.headers.common.Authorization=t,this.cheakLongin()},components:{VoucherModal:se,DelProductModal:T,PaginationModal:B}},le={class:"container"},ae={class:"text-end mt-4"},de={class:"text-end mt-4"},re={class:"table mt-4"},ce=e("thead",null,[e("tr",null,[e("th",{width:"120"},"名稱"),e("th",{width:"120"},"折扣百分比"),e("th",{width:"120"},"到期日"),e("th",{width:"120"},"是否啟用"),e("th",{width:"120"},"編輯")])],-1),ue={key:0,class:"text-success"},he={key:1},me={class:"btn-group"},pe=["onClick"],_e=["onClick"];function fe(t,o,h,y,s,d){const m=r("VueLoading"),p=r("PaginationModal"),v=r("VoucherModal"),c=r("DelProductModal");return l(),a(k,null,[n(m,{active:s.isloading,"z-index":1060},null,8,["active"]),e("div",le,[e("div",ae,[e("button",{class:"btn btn-primary",onClick:o[0]||(o[0]=i=>d.openModel("new"))}," 建立優惠卷 ")]),e("div",de,[e("table",re,[ce,e("tbody",null,[(l(!0),a(k,null,P(s.voucher,i=>(l(),a("tr",{key:i.id},[e("td",null,b(i.title),1),e("td",null,b(i.percent)+"%",1),e("td",null,b(t.$filter.date(i.due_date)),1),e("td",null,[i.is_enabled===1?(l(),a("span",ue,"啟用")):(l(),a("span",he,"未啟用"))]),e("td",null,[e("div",me,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:$=>d.openModel("edit",i)}," 編輯 ",8,pe),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:$=>d.openModel("dele",i)}," 刪除 ",8,_e)])])]))),128))])])])]),n(p,{pages:s.pages,onEmitPages:d.getVoucherData},null,8,["pages","onEmitPages"]),n(v,{"is-New":s.isNew,"temp-Voucher":s.tempVoucher,onEditVoucher:d.editVoucher,ref:"voucher"},null,8,["is-New","temp-Voucher","onEditVoucher"]),n(c,{onDelItem:d.delProduct,"temp-Voucher":s.tempVoucher,ref:"deModal"},null,8,["onDelItem","temp-Voucher"])],64)}const ge=M(ne,[["render",fe]]);export{ge as default};
